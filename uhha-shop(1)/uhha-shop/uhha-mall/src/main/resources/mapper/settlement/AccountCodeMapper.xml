<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.uhha.settlement.mapper.AccountCodeMapper">
    
    <resultMap type="AccountCode" id="AccountCodeResult">
        <result property="id"    column="id"    />
        <result property="status"    column="status"    />
        <result property="currency"    column="currency"    />
        <result property="accountNo"    column="account_no"    />
        <result property="accountType"    column="account_type"    />
    </resultMap>

    <sql id="selectAccountCodeVo">
        select id, status, currency, account_no, account_type from account_code
    </sql>

    <select id="selectAccountCodeList" parameterType="AccountCode" resultMap="AccountCodeResult">
        <include refid="selectAccountCodeVo"/>
        <where>  
            <if test="status != null "> and status = #{status}</if>
            <if test="currency != null "> and currency = #{currency}</if>
            <if test="accountType != null "> and account_type = #{accountType}</if>
            <if test="accountNo != null  and accountNo != ''"> and account_no = #{accountNo}</if>
        </where>
    </select>
    
    <select id="selectAccountCodeById" parameterType="Long" resultMap="AccountCodeResult">
        <include refid="selectAccountCodeVo"/>
        where id = #{id}
    </select>
        
    <insert id="insertAccountCode" parameterType="AccountCode" useGeneratedKeys="true" keyProperty="id">
        insert into account_code
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="status != null">status,</if>
            <if test="currency != null">currency,</if>
            <if test="accountType != null and accountType != ''">account_type,</if>
            <if test="accountNo != null and accountNo != ''">account_no,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="status != null">#{status},</if>
            <if test="currency != null">#{currency},</if>
            <if test="accountType != null and accountType != ''">#{accountType},</if>
            <if test="accountNo != null and accountNo != ''">#{accountNo},</if>
         </trim>
    </insert>

    <update id="allocateAccountCode" parameterType="java.lang.Long">
        update account_code set status = 1 where id =#{id};
    </update>

    <select id="selectFreeAccountCode" parameterType="java.lang.String" resultMap="AccountCodeResult">
        select * from account_code where id in (select min(id) from account_code where account_type =#{accountType} and status =0);
    </select>


    <select id="selectMaxId" resultType="java.lang.Long">
        select max(id) from account_code;
    </select>

</mapper>