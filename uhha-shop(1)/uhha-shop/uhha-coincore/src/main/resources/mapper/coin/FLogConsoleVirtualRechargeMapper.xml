<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="io.uhha.coin.capital.mapper.FLogConsoleVirtualRechargeMapper">
    <resultMap id="BaseResultMap" type="FLogConsoleVirtualRecharge">
        <id column="fid" property="fid" jdbcType="INTEGER"/>
        <result column="famount" property="famount" jdbcType="DECIMAL"/>
        <result column="fcoinid" property="fcoinid" jdbcType="INTEGER"/>
        <result column="ftype" property="ftype" jdbcType="INTEGER"/>
        <result column="fstatus" property="fstatus" jdbcType="INTEGER"/>
        <result column="fuid" property="fuid" jdbcType="INTEGER"/>
        <result column="fissendmsg" property="fissendmsg" jdbcType="INTEGER"/>
        <result column="fcreatorid" property="fcreatorid" jdbcType="INTEGER"/>
        <result column="finfo" property="finfo" jdbcType="VARCHAR"/>
        <result column="fcreatetime" property="fcreatetime" jdbcType="TIMESTAMP"/>
        <result column="version" property="version" jdbcType="INTEGER"/>
    </resultMap>

    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		delete from f_log_console_virtual_recharge where fid = #{fid,jdbcType=INTEGER}
	</delete>

    <insert id="insert" parameterType="FLogConsoleVirtualRecharge" keyProperty="fid">
		insert into f_log_console_virtual_recharge (
			famount,
			fcoinid,
			ftype,
			fstatus, 
			fuid,
			fissendmsg,
			fcreatorid,
			finfo,
			fcreatetime, 
			version
		) values (
			#{famount,jdbcType=DECIMAL},
			#{fcoinid,jdbcType=INTEGER},
			#{ftype,jdbcType=INTEGER},
			#{fstatus,jdbcType=INTEGER}, 
			#{fuid,jdbcType=BIGINT},
			#{fissendmsg,jdbcType=INTEGER},
			#{fcreatorid,jdbcType=INTEGER},
			#{finfo,jdbcType=VARCHAR},
			#{fcreatetime,jdbcType=TIMESTAMP},
			#{version,jdbcType=INTEGER}
		)
	</insert>

    <update id="updateByPrimaryKey" parameterType="FLogConsoleVirtualRecharge">
		update 
			f_log_console_virtual_recharge
		set
			famount = #{famount,jdbcType=DECIMAL},
			fcoinid = #{fcoinid,jdbcType=INTEGER},
			ftype = #{ftype,jdbcType=INTEGER},
			fstatus = #{fstatus,jdbcType=INTEGER},
			fuid = #{fuid,jdbcType=BIGINT},
			fissendmsg = #{fissendmsg,jdbcType=INTEGER},
			fcreatorid = #{fcreatorid,jdbcType=INTEGER},
			finfo = #{finfo,jdbcType=VARCHAR},
			fcreatetime = #{fcreatetime,jdbcType=TIMESTAMP},
			version = version + 1
		where 
			fid = #{fid,jdbcType=INTEGER} and version = #{version}
	</update>

    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer">
		select 
			fid,
			famount,
			fcoinid,
			ftype,
			fstatus, 
			fuid, 
			fissendmsg, 
			fcreatorid,
			finfo,
			fcreatetime, 
			version
		from 
			f_log_console_virtual_recharge
		where 
			fid = #{fid,jdbcType=INTEGER}
	</select>

    <!-- Admin -->
    <select id="getAdminPageList" resultType="FLogConsoleVirtualRecharge" parameterType="java.util.Map">
        select
        f_log_console_virtual_recharge.fid,
        f_log_console_virtual_recharge.famount,
        f_log_console_virtual_recharge.fcoinid,
        f_log_console_virtual_recharge.ftype,
        f_log_console_virtual_recharge.fstatus,
        f_log_console_virtual_recharge.fuid,
        f_log_console_virtual_recharge.fissendmsg,
        f_log_console_virtual_recharge.fcreatorid,
        f_log_console_virtual_recharge.finfo,
        f_log_console_virtual_recharge.fcreatetime,
        f_log_console_virtual_recharge.version,
        ums_member.username,
        ums_member.nickname,
        concat(ums_member.firstname,' ',ums_member.lastname) frealname,
        sys_user.user_name fadminname,
        system_coin_type.name fcoinname
        from
        f_log_console_virtual_recharge left join
        ums_member on ums_member.id = f_log_console_virtual_recharge.fuid left join
        sys_user on sys_user.user_id = f_log_console_virtual_recharge.fcreatorid left join
        system_coin_type on system_coin_type.id = f_log_console_virtual_recharge.fcoinid
        where 1=1
        <if test="keyword != null">
            and (
            ums_member.username like concat('%',#{keyword,jdbcType=VARCHAR},'%') or
            ums_member.nickname like concat('%',#{keyword,jdbcType=VARCHAR},'%') or
            ums_member.email like concat('%',#{keyword,jdbcType=VARCHAR},'%') or
            ums_member.mobile like concat('%',#{keyword,jdbcType=VARCHAR},'%') or
            ums_member.firstname like concat('%',#{keyword,jdbcType=VARCHAR},'%') or
            ums_member.lastname like concat('%',#{keyword,jdbcType=VARCHAR},'%') or
            ums_member.id = #{keyword,jdbcType=VARCHAR}
            )
        </if>
        <if test="fstatus != null">
            and f_log_console_virtual_recharge.fstatus in
            <foreach collection="fstatus" item="item" open="(" separator="," close=")">
                ${item}
            </foreach>
        </if>
        <if test="ftype != null">
            and ftype = #{ftype,jdbcType=INTEGER}
        </if>
        <if test="fcoinid != null">
            AND f_log_console_virtual_recharge.fcoinid = #{fcoinid,jdbcType=INTEGER}
        </if>
        <if test="start != null and start == end">
            <![CDATA[and DATE_FORMAT(f_log_console_virtual_recharge.fcreatetime,"%Y-%m-%d") = DATE_FORMAT(#{start},"%Y-%m-%d")]]>
        </if>
        <if test="start != null and start != end">
            <![CDATA[and DATE_FORMAT(f_log_console_virtual_recharge.fcreatetime,"%Y-%m-%d") >= DATE_FORMAT(#{start},"%Y-%m-%d")]]>
        </if>
        <if test="end != null and start != end">
            <![CDATA[and DATE_FORMAT(f_log_console_virtual_recharge.fcreatetime,"%Y-%m-%d") <= DATE_FORMAT(#{end},"%Y-%m-%d")]]>
        </if>
        <if test="orderField != null">
            order by f_log_console_virtual_recharge.${orderField} ${orderDirection}
        </if>
        limit #{offset},#{limit}
    </select>

    <select id="countAdminPage" resultType="java.lang.Integer" parameterType="java.util.Map">
        select count(*)
        from
        f_log_console_virtual_recharge left join
        ums_member on ums_member.id = f_log_console_virtual_recharge.fuid left join
        sys_user on sys_user.user_id = f_log_console_virtual_recharge.fcreatorid
        where 1=1
        <if test="keyword != null">
            and (
            ums_member.username like concat('%',#{keyword,jdbcType=VARCHAR},'%') or
            ums_member.nickname like concat('%',#{keyword,jdbcType=VARCHAR},'%') or
            ums_member.email like concat('%',#{keyword,jdbcType=VARCHAR},'%') or
            ums_member.mobile like concat('%',#{keyword,jdbcType=VARCHAR},'%') or
            ums_member.firstname like concat('%',#{keyword,jdbcType=VARCHAR},'%') or
            ums_member.lastname like concat('%',#{keyword,jdbcType=VARCHAR},'%') or
            ums_member.id = #{keyword,jdbcType=VARCHAR}
            )
        </if>
        <if test="fstatus != null">
            and f_log_console_virtual_recharge.fstatus in
            <foreach collection="fstatus" item="item" open="(" separator="," close=")">
                ${item}
            </foreach>
        </if>
        <if test="fcoinid != null">
            AND f_log_console_virtual_recharge.fcoinid = #{fcoinid,jdbcType=INTEGER}
        </if>
        <if test="ftype != null">
            and ftype = #{ftype,jdbcType=INTEGER}
        </if>
        <if test="start != null and start == end">
            <![CDATA[and DATE_FORMAT(f_log_console_virtual_recharge.fcreatetime,"%Y-%m-%d") = DATE_FORMAT(#{start},"%Y-%m-%d")]]>
        </if>
        <if test="start != null and start != end">
            <![CDATA[and DATE_FORMAT(f_log_console_virtual_recharge.fcreatetime,"%Y-%m-%d") >= DATE_FORMAT(#{start},"%Y-%m-%d")]]>
        </if>
        <if test="end != null and start != end">
            <![CDATA[and DATE_FORMAT(f_log_console_virtual_recharge.fcreatetime,"%Y-%m-%d") <= DATE_FORMAT(#{end},"%Y-%m-%d")]]>
        </if>
    </select>


    <select id="getTotalAmountByStatus" resultType="java.math.BigDecimal" parameterType="java.util.Map">
        select ifnull(sum(famount), 0)
        from
        f_log_console_virtual_recharge
        where 1=1
        <if test="status != null">
            and f_log_console_virtual_recharge.fstatus = ${status}
        </if>
        <if test="fuid != null">
            and fuid = #{fuid}
        </if>
        <if test="coinid != null">
            and fcoinid = #{coinid}
        </if>
        <if test="start != null">
            <![CDATA[and fcreatetime >= #{start,jdbcType=VARCHAR}]]>
        </if>
        <if test="end != null">
            <![CDATA[and fcreatetime <= #{end,jdbcType=VARCHAR}]]>
        </if>
    </select>

    <select id="selectConsoleVirtualRechargeListByParam" resultType="FLogConsoleVirtualRecharge"
            parameterType="java.util.Map">
        select
        fid,
        famount,
        fcoinid,
        ftype,
        fstatus,
        fuid,
        fissendmsg,
        fcreatorid,
        finfo,
        fcreatetime,
        version
        from
        f_log_console_virtual_recharge
        where 1=1
        <if test="ftype != null">
            and ftype = #{ftype,jdbcType=INTEGER}
        </if>
        <if test="fuid != null">
            and fuid = #{fuid,jdbcType=BIGINT}
        </if>
        <if test="famount != null">
            and famount = #{famount,jdbcType=DECIMAL}
        </if>
        <if test="finfo != null">
            and finfo =#{finfo,jdbcType=VARCHAR}
        </if>
        <if test="fstatus != null">
            and fstatus = #{fstatus,jdbcType=INTEGER}
        </if>
        <if test="start != null and start == end">
            <![CDATA[and DATE_FORMAT(f_log_console_virtual_recharge.fcreatetime,"%Y-%m-%d") = DATE_FORMAT(#{start},"%Y-%m-%d")]]>
        </if>
        <if test="start != null and start != end">
            <![CDATA[and DATE_FORMAT(f_log_console_virtual_recharge.fcreatetime,"%Y-%m-%d") >= DATE_FORMAT(#{start},"%Y-%m-%d")]]>
        </if>
        <if test="end != null and start != end">
            <![CDATA[and DATE_FORMAT(f_log_console_virtual_recharge.fcreatetime,"%Y-%m-%d") <= DATE_FORMAT(#{end},"%Y-%m-%d")]]>
        </if>
    </select>

    <select id="selectFLogConsoleVirtualRechargeByParam" resultType="FLogConsoleVirtualRecharge"
            parameterType="java.util.Map">
        select
        fid,
        famount,
        fcoinid,
        ftype,
        fstatus,
        fuid,
        fissendmsg,
        fcreatorid,
        finfo,
        fcreatetime,
        version
        from
        f_log_console_virtual_recharge
        where 1=1
        <if test="ftype != null">
            and ftype = #{ftype,jdbcType=INTEGER}
        </if>
        <if test="fuid != null">
            and fuid = #{fuid,jdbcType=BIGINT}
        </if>
        <if test="fstatus != null">
            and fstatus = #{fstatus,jdbcType=INTEGER}
        </if>
        <if test="finfo != null">
            and finfo = #{finfo,jdbcType=VARCHAR}
        </if>
    </select>
</mapper>